[% menu_settings = 'ringpages' %]
[% menu_subnav = 'ringpages' %]
[% content = BLOCK %]
[% INCLUDE u/settings/menu.html %]
<div id="masthead">
	<div class="container">
		<div class="masthead-pad">
			<div class="masthead-text">
				<h2>RingPage: [% ringpage.ringpage %]</h2>
			</div>
		</div>
	</div>
</div>
<div id="content">
	<form id="form" method="post" action="[% page.url( query => { ringpage_id => page.form.ringpage_id, }, ) %]" style="margin: 0px; padding: 0px;">
		<fieldset>
			<div class="container">
				<div class="tabbable">
					<div class="row">
						<div class="main-wrapper">
							<h2>[% page.button(
								command => 'edit',
								text => 'Update',
								type => 'submit',
								opts => {
								class => 'btn btn-primary btn-hide',
								id => 'do-1_1',
								},
								args => [ page.form.ringpage_id, ],
								) %]</h2>
							<div class="span6 pull-left">
								<table class="table table-bordered logo">
									<tbody>
									<tr>
										<td class="td-label"><label>Logo</label></td>
										<td class="logo-inputs">
											<ul>
												<li>
												[% page.field(
												command => 'edit',
												type => 'radio',
												name => 'logo_style',
												value => 'circle',
												checked => ringpage.logo_style == 'circle' ? 1 : 0,
												opts => {
												class => 'logo-upload-input',
												},
												) %]
												<img class="shape-ph-img" src="/img/round-ph.png" height="50px" width="50px" />
												[% page.field(
												command => 'edit',
												type => 'radio',
												name => 'logo_style',
												value => 'square',
												checked => ringpage.logo_style == 'square' ? 1 : 0,
												opts => {
												class => 'logo-upload-input',
												},
												) %]
												<img class="shape-ph-img" src="/img/square-ph.png" height="50px" width="50px" />
												[% page.field(
												command => 'edit',
												type => 'file',
												name => 'logo',
												opts => {
												'data-url' => '/u/upload/logo',
												id => 'f_d1-logo',
												},
												) %]
												</li>
											</ul>
											<div id="progress_logo">
												<div class="bar" style="width: 0%;"></div>
											</div>
										</td>
									</tr>
									</tbody>
								</table>
								<table class="table table-bordered theme">
									<tbody>
									<tr>
										<td class="td-label"><label>Theme</label></td>
										<td>
											<ul class="theme-ul">
												[% FOREACH theme IN ringpage_template.structure.themes %]
												<li>
												<ul>
													<li><span class="input-group-addon">
														[% page.field(
														command => 'edit',
														type => 'radio',
														name => 'theme_name',
														value => theme.name,
														checked => theme.name == ringpage.theme_name ? 1 : 0,
														) %]
													</span></li>
													<li style="background-color:[% theme.color_1 %];"></li>
													<li style="background-color:[% theme.color_2 %];"></li>
												</ul>
												</li>
												[% END %]
											</ul>
										</td>
									</tr>
									</tbody>
								</table>
								[% IF ringpage.image.defined %]
								<table class="table table-bordered media">
									<tbody>
									<tr>
										<td class="td-label"><label>Main Image</label></td>
										<td>
											<ul>
												<li>
												[% page.field(
												command => 'edit',
												type => 'file',
												name => 'image',
												opts => {
												'data-url' => '/u/upload/image',
												id => 'f_d1-image',
												},
												) %]
												</li>
											</ul>
											<div id="progress_image">
												<div class="bar" style="width: 0%;"></div>
											</div>
										</td>
									</tr>
									</tbody>
								</table>
								[% END %]
								<table class="table table-bordered media">
									<tbody>
									<tr>
										<td class="td-label"><label>Title</label></td>
										<td>
											<ul>
												<li>
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'title',
												value => ringpage.title,
												opts => {
												placeholder => 'Title',
												},
												) %]
											</ul>
										</td>
									</tr>
									</tbody>
								</table>
								[% IF ringpage.video_url.defined %]
								<table class="table table-bordered media">
									<tbody>
									<tr>
										<td class="td-label"><label>Video</label></td>
										<td>
											<ul>
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'video_url',
												value => ringpage.video_url,
												opts => {
												placeholder => 'Video Embed URL',
												},
												) %]
											</ul>
										</td>
									</tr>
									</tbody>
								</table>
								[% END %]
								<table class="table table-bordered text-content">
									<tbody>
									<tr>
										<td class="td-label"><label>Content</label></td>
										<td class="td-inputs">
											<ul class="inputs-ul">
												<li>
												<label>Headline</label>
												<br />
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'headline',
												value => ringpage.headline,
												opts => {
												placeholder => 'Headline',
												},
												) %]
												</li>
												<li>
												<label>Subhead</label>
												<br />
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'subhead',
												value => ringpage.subhead,
												opts => {
												placeholder => 'Subhead',
												},
												) %]
												</li>
												<li>
												<label>Body Headline</label>
												<br />
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'body_headline',
												value => ringpage.body_headline,
												opts => {
												placeholder => 'Body Headline',
												},
												) %]
												</li>
												<li>
												<label>Body</label>
												<br />
												[% page.field(
												command => 'edit',
												type => 'textarea',
												name => 'body',
												value => ringpage.body,
												opts => {
												placeholder => 'Body',
												},
												) %]
												</li>
												<li>
												<label>Footer</label>
												<br />
												[% page.field(
												command => 'edit',
												type => 'textarea',
												name => 'footer',
												value => ringpage.footer,
												opts => {
												placeholder => 'Footer',
												},
												) %]
												</li>
											</ul>
										</td>
									</tr>
									</tbody>
								</table>
								<table class="table table-bordered buttons">
									<tbody>
									<tr>
										<td class="td-label"><label>Buttons</label></td>
										<td class="td-inputs">
											[% IF buttons.size < ringpage_template.buttons %]
											<ul class="radio-wrapper">
												<li>
												[% IF ringpage.image_height > 0 and ( buttons.size + 1 ) * 90 + 40 > ringpage.image_height and ringpage.template == 'v2' %]
												[% page.button(
												command => 'add_button',
												text => 'Add Button',
												opts => {
												class=> 'btn btn-primary btn-lg',
												onclick => "alert('Main image is too short to fit more buttons.'); return false;",
												},	
												) %]
												[% ELSE %]
												[% page.button(
												command => 'add_button',
												text => 'Add Button',
												opts => {
												'data-target' => '#editButtonsModal',
												'data-toggle' => 'modal',
												class=> 'btn btn-primary btn-lg',
												},	
												) %]
												[% END %]
												</li>
											</ul>
											[% ELSE %]
											<ul class="radio-wrapper">
												<li class="blank-li">&nbsp;</li>
											</ul>
											[% END %]
											[% FOREACH button IN buttons %]
											<ul class="button-data-ul">
												<li>
												[% button.button %]
												</li>
												<li>
												[% button.uri %]
												</li>
												<li>
												<a id="edit_buttons"
													data-button_id="[% button.id %]"
													data-button_link="[% button.uri %]"
													data-button_position="[% button.position %]"
													data-button_text="[% button.button %]"
													data-target="#editButtonsModal"
													data-toggle="modal"
													/>
													Edit
												</a>
												</li>
												<li>
												[% page.link(
												text => '<i class="fa fa-minus"></i>',
												command => 'button_delete',
												args => [ ringpage.id, button.id, ],
												opts => {
												onclick => "return confirm( 'Really Delete Button: $button.button?' );",
												class=>'delbtn-a',
												},
												) %]
												</li>
											</ul>
											[% END %]
										</td>
									</tr>
									</tbody>
								</table>
								<table class="table table-bordered background">
									<tbody>
									<tr>
										<td class="td-label"><label>Links</label></td>
										<td class="td-options">
											<ul class="radio-wrapper">
												<li style="height:42px;">
												<label class="" for="facebook">Homepage</label></li>
												<li style="height:42px;">
												<label class="" for="facebook">Facebook</label></li>
												<li style="height:42px;">
												<label class="" for="twitter">Twitter</label></li>
												<li style="height:42px;">
												<label class="" for="instagram">Instagram</label></li>
												<li style="height:42px;">
												<label class="" for="linkedin">LinkedIn</label></li>
												<li style="height:42px;">
												<label class="" for="googleplus">Google+</label></li>
												<li style="height:42px;">
												<label class="" for="pinterest">Pinterest</label></li>
												<li style="height:42px;">
												<label class="" for="youtube">YouTube</label></li>
											</ul>
										</td>
										<td class="td-inputs">
											<ul class="buttons-ul">
												<li style="height:42px;">
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'homepage_url',
												value => ringpage.homepage_url,
												opts => {
												placeholder => 'Homepage URL',
												},
												) %]
												</li>
												<li style="height:42px;">
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'facebook_url',
												value => ringpage.facebook_url,
												opts => {
												placeholder => 'Facebook URL',
												},
												) %]
												</li>
												<li style="height:42px;">
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'twitter_url',
												value => ringpage.twitter_url,
												opts => {
												placeholder => 'Twitter URL',
												},
												) %]
												</li>
												<li style="height:42px;">
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'instagram_url',
												value => ringpage.instagram_url,
												opts => {
												placeholder => 'Instagram URL',
												},
												) %]
												</li>
												<li style="height:42px;">
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'linkedin_url',
												value => ringpage.linkedin_url,
												opts => {
												placeholder => 'LinkedIn URL',
												},
												) %]
												</li>
												<li style="height:42px;">
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'googleplus_url',
												value => ringpage.googleplus_url,
												opts => {
												placeholder => 'Google+ URL',
												},
												) %]
												</li>
												<li style="height:42px;">
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'pinterest_url',
												value => ringpage.pinterest_url,
												opts => {
												placeholder => 'Pinterest URL',
												},
												) %]
												</li>
												<li style="height:42px;">
												[% page.field(
												command => 'edit',
												type => 'text',
												name => 'youtube_url',
												value => ringpage.youtube_url,
												opts => {
												placeholder => 'YouTube URL',
												},
												) %]
												</li>
											</ul>
										</td>
									</tr>
									</tbody>
								</table>
								<div>
									<p style="text-align: right;">
									[% page.button(
									command => 'edit',
									text => 'Update',
									type => 'submit',
									opts => {
									class => 'btn btn-primary',
									id => 'do-1_1',
									},
									args => [ page.form.ringpage_id, ],
									) %]
									</p>
								</div>
							</div>
						</div>
						<div class="span6 pull-right">
							<div id="preview"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="modal fade" id="editButtonsModal" tabindex="-1" role="dialog" aria-labelledby="editButtonsModal">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header add-button">
							[% page.button(
							command => 'edit',
							text => '<span aria-hidden="true">&times;</span>',
							type => 'button',
							opts => {
							'aria-label' => 'Close',
							class => 'close',
							'data-dismiss' => 'modal',
							id => 'edit_buttons_close',
							},
							) %]
							<h4 class="modal-title">Add Button</h4>
						</div>
						<div class="modal-body">
							[% page.field(
							command => 'edit',
							type => 'hidden',
							name => 'button_id',
							opts => {
							id => 'button_id',
							},
							) %]
							<ul class="modal-ul">
								<li>
								<span class="input-group-addon">
									<label>Button Text</label>
									[% page.field(
									command => 'edit',
									type => 'text',
									name => 'button_text',
									opts => {
									id => 'button_text',
									placeholder => 'Text',
									},
									) %]
								</span></li>
							</ul>
							<hr>
							<ul class="modal-options-ul">
								<li><span class="input-group-addon">
									<label>Link</label>
									[% page.field(
									command => 'edit',
									type => 'text',
									name => 'button_link',
									opts => {
									id => 'button_link_1',
									placeholder => 'URL',
									},
									) %]
								</span>
								</li>
								<li><span class="input-group-addon">
									<label>Call</label>
									<div class="input-prepend">
										<span class="add-on">ring://</span>
										[% page.field(
										command => 'edit',
										type => 'text',
										name => 'button_link',
										opts => {
										id => 'button_link_2',
										placeholder => 'RingMail Address',
										},
										) %]
									</div>
								</span>
								</li>
								<li><span class="input-group-addon">
									<label>Video</label>
									<div class="input-prepend">
										<span class="add-on">ring://</span>
										[% page.field(
										command => 'edit',
										type => 'text',
										name => 'button_link',
										opts => {
										id => 'button_link_3',
										placeholder => 'RingMail Address',
										},
										) %]
									</div>
								</span>
								</li>
								<li><span class="input-group-addon">
									<label>Chat</label>
									<div class="input-prepend">
										<span class="add-on">ring://</span>
										[% page.field(
										command => 'edit',
										type => 'text',
										name => 'button_link',
										opts => {
										id => 'button_link_4',
										placeholder => 'RingMail Address',
										},
										) %]
									</div>
								</span>
								</li>
							</ul>
						</div>
						<div class="modal-footer">
							[% page.button(
							command => 'edit',
							text => 'Close',
							type => 'button',
							opts => {
							class => 'btn btn-default',
							'data-dismiss' => 'modal',
							id => 'edit_buttons_close',
							},
							) %]
							[% page.button(
							command => 'edit',
							text => 'Save',
							type => 'submit',
							opts => {
							class => 'btn btn-primary',
							},
							args => [ page.form.ringpage_id, ],
							) %]
						</div>
					</div>
				</div>
			</div>
		</fieldset>
	</form>
</div>
<script src="/js/jquery.fileupload.js"></script>
<script>
bioMp(document.getElementById('preview'), {
url: '/ringpage?ringpage_id=[% page.form.ringpage_id %]',
view: 'front',
image: '/img/iphone6_front_white.png',
scale: '.8'
});
$('#editButtonsModal').on('shown.bs.modal', function () {
		$('#myInput').focus()
		});
$('#editButtonsModal').on('hidden.bs.modal', function () {
		$('#button_id').val(null);
		$('#button_link_1').val(null);
		$('#button_link_2').val(null);
		$('#button_link_3').val(null);
		$('#button_link_4').val(null);
		$('#button_text').val(null);
		});
$( function () {
		$( '#f_d1-logo' ).fileupload( {
formData: { ringpage_id: '[% page.form.ringpage_id %]' },
dataType: 'json',
done: function ( e, data ) {
$( '#do-1_1' ).click();
},
progressall: function ( e, data ) {
var progress = parseInt( data.loaded / data.total * 100, 10 );
$('#progress_logo .bar').css(
	'width',
	progress + '%'
	);
}
} );
		$( '#f_d1-image' ).fileupload( {
formData: {
ringpage_id: '[% page.form.ringpage_id %]',
buttons: '[% buttons.size %]'
},
dataType: 'json',
done: function ( e, data ) {
if ( data.result.error == 'size' ) {
alert('Main image is too short to fit all the buttons.');
return false;
}
$( '#do-1_1' ).click();
},
progressall: function ( e, data ) {
var progress = parseInt( data.loaded / data.total * 100, 10 );
$('#progress_image .bar').css(
	'width',
	progress + '%'
	);
}
} );
});
$(document).on( 'click', '#edit_buttons',function(e) {
		$('#button_id').val($(this).data('button_id'));
		$('#button_link_' + $(this).data('button_position')).val($(this).data('button_link'));
		$('#button_text').val($(this).data('button_text'));
		});
$(document).on( 'click', '#edit_buttons_close',function(e) {
		$('#button_id').val(null);
		$('#button_link_1').val(null);
		$('#button_link_2').val(null);
		$('#button_link_3').val(null);
		$('#button_link_4').val(null);
		$('#button_text').val(null);
		});
</script>
[% END %]
[% INCLUDE layout/internal.html %]
